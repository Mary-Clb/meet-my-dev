<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Welcome!{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text></svg>">
        {# Run `composer require symfony/webpack-encore-bundle` to start using Symfony UX #}
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">  
        <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
        <link href="{{ asset('css/style.css') }}" rel="stylesheet">

        {% block stylesheets %}
            {{ encore_entry_link_tags('app') }}
        {% endblock %}

        {% block javascripts %}
            {{ encore_entry_script_tags('app') }}
        {% endblock %}
    </head>
        <body class="d-flex flex-column min-vh-100">
        <div class="wrapper flex-grow-1">   
            {% include 'navbar.html.twig' %}
            <div class="container content">
                {% block body %}{% endblock %}
            </div> 
        </div>
        {% include 'footer.html.twig' %}
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
        <script>

            $(document).ready(function () {

                let select = "";
                let url = ""
                let profile = false;

                if ($("#edit_profile_specialities").length) {
                    // Initialize select2 for the specialities select element
                    select  = $("#edit_profile_specialities");
                    url = '/api/languages'
                    profile = true
                }else if ($("#edit_profile_activities").length) {
                    // Initialize select2 for the activities select element
                    select  = $("#edit_profile_activities");
                    url = '/api/activities'
                    profile = true  
                }else if ($("#dev_specialities").length) {
                    // Initialize select2 for the specialities select element
                    select  = $("#dev_specialities");
                    url = '/api/languages'
                }else if ($("#company_activities").length) {
                    // Initialize select2 for the activities select element
                    select  = $("#company_activities");
                    url = '/api/activities'
                }

                if(profile === true){
                    $('#editProfileModal').on('shown.bs.modal', function() {
                        select.select2({

                        dropdownParent: $('#editProfileModal'),

                        ajax: {
                        url: url,
                        dataType: 'json',
                        delay: 0,
                        data: function (params) {
                        return {filter: params.term};
                        },
                        templateResult: function(data) {
                            return data.label;
                        },
                        processResults: function (data) {
                        const languages = JSON.parse(data.options);
                        return {
                            results: languages.map(function (option) {

                            return {id: option.id, text: option.label};
                            })
                        };
                        },
                        cache: true
                        },
                        placeholder: 'Search languages...'
                        })
                    });  
                }else{
                    select.select2({

                        ajax: {
                        url: url,
                        dataType: 'json',
                        delay: 0,
                        data: function (params) {
                        return {filter: params.term};
                        },
                        templateResult: function(data) {
                            return data.label;
                        },
                        processResults: function (data) {
                        const languages = JSON.parse(data.options);
                        return {
                            results: languages.map(function (option) {

                            return {id: option.id, text: option.label};
                            })
                        };
                        },
                        cache: true
                        },
                        placeholder: 'Search languages...'
                        })
                }

                // function initSelect(){
                //     select.select2({

                //         dropdownParent: $('#editProfileModal'),

                //         ajax: {
                //         url: url,
                //         dataType: 'json',
                //         delay: 0,
                //         data: function (params) {
                //         return {filter: params.term};
                //         },
                //         templateResult: function(data) {
                //             return data.label;
                //         },
                //         processResults: function (data) {
                //         const languages = JSON.parse(data.options);
                //         return {
                //             results: languages.map(function (option) {

                //             return {id: option.id, text: option.label};
                //             })
                //         };
                //         },
                //         cache: true
                //         },
                //         placeholder: 'Search languages...'
                //         })
                // };
            });
            $('.dropdown-menu').on('click', function(event) {
                event.stopPropagation();
                
            });
        </script>

    </body>
</html>